# -*- coding: utf-8 -*-
"""models project

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1z4-JckaVV-xlaLcQJCmTrBipxGG-r9IY

#Lung Disease Prediction - Supervised ML

###To build a Model that peredicts Lung Disease early by using Patient Information

##Decision Tree Algorithm
"""

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.datasets import load_iris
from sklearn.tree import DecisionTreeClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score,confusion_matrix,classification_report

iris=load_iris()

df=pd.DataFrame(data=iris.data,columns=iris.feature_names)

df

from google.colab import files
up=files.upload()

data=pd.read_csv(r'lung_disease_data.csv')

df=pd.DataFrame(data)

df

df.dropna(inplace=True)

df.duplicated().sum()

df.isnull().sum()

df

df['Gender']=df['Gender'].replace("Male",1)
df['Gender']=df['Gender'].replace("Female",0)
df['Smoking Status']=df['Smoking Status'].replace("Yes",1)
df['Smoking Status']=df['Smoking Status'].replace("No",0)
df['Recovered']=df['Recovered'].replace("Yes",1)
df['Recovered']=df['Recovered'].replace("No",0)
df['Treatment Type']=df['Treatment Type'].replace("Therapy",1)
df['Treatment Type']=df['Treatment Type'].replace("Medication",0)
df['Treatment Type']=df['Treatment Type'].replace("Surgery",2)
df['Disease Type']=df['Disease Type'].replace("COPD",3)
df['Disease Type']=df['Disease Type'].replace("Lung Cancer",4)
df['Disease Type']=df['Disease Type'].replace("Pneumonia",5)
df['Disease Type']=df['Disease Type'].replace("Bronchitis",6)
df['Disease Type']=df['Disease Type'].replace("Asthma",7)

x=df[['Age','Gender','Treatment Type','Smoking Status','Hospital Visits','Recovered','Lung Capacity']]

y=df[['Disease Type']]

x

x_train,x_test,y_train,y_test=train_test_split(x,y,test_size=0.3,random_state=42)

model=DecisionTreeClassifier()

model.fit(x_train,y_train)

y_pred=model.predict(x_test)

from sklearn.metrics import accuracy_score,confusion_matrix,classification_report

print("acc",accuracy_score(y_test,y_pred))

import seaborn as sns
cm=confusion_matrix(y_test,y_pred)

sns.heatmap(cm,annot=True)

cm

import pandas as pd
from google.colab import files

df=pd.DataFrame(data)

df

df.head()

df.info()

df

df.describe()

df.isnull().sum()

df.duplicated().sum()

df.drop_duplicates(inplace=True)

df.dropna()

df.fillna("no data")

avg=df['Hospital Visits'].mean()

df['Hospital Visits'].fillna(avg,inplace=True)

df

df['Treatment Type'].fillna("not mentioned",inplace=True)

df

df.isnull().sum()

df.duplicated().sum()

df

df['Gender']=df['Gender'].replace("Male","M")

df

df['Gender']=df['Gender'].replace("Female","F")

df

df['Age+10']=df['Age']+10

df

Hospital_Visits_mean=df['Hospital Visits'].mean()

df

median=df['Hospital Visits'].median()

df

"""#Group & PivotBy"""

group=df.groupby('Treatment Type')['Hospital Visits'].mean()

group

pivot=pd.pivot_table(df,
                     values='Hospital Visits',
                     index='Treatment Type',
                     columns='Gender',
                     aggfunc=['mean','sum']
                     )

pivot

"""#Matplot Visualization




"""

import matplotlib.pyplot as plt

plt.hist(df['Treatment Type'],color='pink',bins=4)
plt.xlabel("Treatment Type")
plt.ylabel("Hospital Visits")
plt.xticks(rotation=45)
plt.title("Treatment Type VS Hospital Visits")
plt.show()

plt.bar(df['Treatment Type'],df['Hospital Visits'])
plt.title("Treatment Type vs Hospital Visits")
plt.xlabel("Treatment Type")
plt.ylabel("Hospital Visits")
plt.xticks(rotation=45)
plt.show()

group1=df.groupby('Treatment Type')['Hospital Visits'].sum()

group1

plt.plot(group1)
plt.show()

plt.pie(group1,labels=['Therapy','Surgery','Medicator','not mentioned'])
plt.legend()

"""#Dashboard"""

plt.figure(figsize=(16,12))
plt.suptitle("Lung Disease Dashboard",fontsize=18)
plt.subplot(3,2,1)
plt.pie(group1,labels=['not mentioned','Medicator','Therapy','Surgery'])
plt.legend()
plt.subplot(3,2,2)
plt.plot(group1)
plt.subplot(3,2,3)
plt.bar(df['Treatment Type'],df['Hospital Visits'])
plt.title("Treatment Type vs Hospital Visits")
plt.xlabel("Treatment Type")
plt.ylabel("Hospital Visits")
plt.xticks(rotation=45)
plt.subplot(3,2,4)
plt.hist(df['Treatment Type'],color='pink',bins=4)
plt.xlabel("Treatment Type")
plt.ylabel("Hospital Visits")
plt.xticks(rotation=45)
plt.title("Treatment Type VS Hospital Visits")
plt.tight_layout()
plt.show()

"""##Download Model"""

import pickle

with open("model.pkl", "wb")as f:
  pickle.dump(model,f)

from google.colab import files
files.download("model.pkl")

import pickle
pickle.dump(model,open("model.pkl","wb"))

import pandas as pd

print("Enter patient details to predict disease type:\n")

age = int(input("Age: "))
lung_capacity = float(input("Lung Capacity: "))
smoking = input("Smoking Status (Yes/No): ")
gender = input("Gender (M/F): ")
visits = int(input("Hospital Visits: "))
recovered = input("Recovered (Yes/No): ")
treatment = input("Treatment Type: ")

# Create input dataframe
input_data = pd.DataFrame([{
    'Age': age,
    'Lung Capacity': lung_capacity,
    'Smoking Status': smoking,
    'Gender': gender,
    'Hospital Visits': visits,
    'Recovered': recovered,
    'Treatment Type': treatment
}])

# IMPORTANT: reorder columns to match training EXACTLY
input_data = input_data[model.feature_names_in_]

# IMPORTANT: use the same encoders from training
# Example encodings (MUST match your training)
binary_map = {
    "Yes": 1,
    "No": 0,
    "M": 1,
    "F": 0
}

for col in ['Smoking Status', 'Gender', 'Recovered']:
    input_data[col] = input_data[col].map(binary_map)

# If you had label encoding for Treatment Type during training
# Replace this with your REAL mapping
treatment_mapping = {
    'Type A': 0,
    'Type B': 1,
    'Type C': 2
}
input_data['Treatment Type'] = input_data['Treatment Type'].map(treatment_mapping)

# Convert to numeric
input_data = input_data.apply(pd.to_numeric)

# Predict
prediction = model.predict(input_data)
print("\nPredicted Disease Type:", prediction[0])

